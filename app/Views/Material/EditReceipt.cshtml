
@model DKAC.Models.InfoModel.DonHangInfo
@{
    ViewBag.Title = "Nhập liệu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    label {
        margin-top: 8px;
        color: #435d7d;
        font-weight: 700;
    }

    .form-group {
        border: 2px solid #afc9e4;
        background: #f9fcff;
        padding: 20px;
    }

        .form-group .row {
            margin-top: 20px;
            margin-bottom: 20px;
        }

    .table-bordered td, .table-bordered th {
        padding: 5px !important;
        vertical-align: middle !important;
    }

    svg:not(:root).svg-inline--fa {
        color: red;
    }

    .lock {
        color: black;
        background-color: white;
        border: none;
    }

    .home {
        color: #1bbd36 !important;
    }

    .inputText {
        padding: 3px !important;
        font-size: 14px !important;
    }

    .form-group {
        margin-bottom: 0;
    }


    margin-top-15 {
        margin-top: 15px !important;
    }

    .modal-header {
        background-color: #0076d2;
        color: white;
    }

    .modal-content {
        border: #d0d0d0 solid 2px !important;
        background-color: #fff7ec;
    }

    .ui-autocomplete {
        z-index: 1000;
    }


    .p-l-0 {
        padding-left: 0px !important;
    }

    .margin-top-10 {
        margin-top: 10px !important;
    }

    .margin-top-40 {
        margin-top: 40px !important
    }

    .modal-dialog-center {
        margin-top: 25%;
    }
</style>

<head>
    <title>Nhập liệu phiếu</title>
</head>

<div class="container">
    <div class="table-wrapper">
        <div class="table-title">
            <div class="row">
                <div class="col-sm-6 uppercase">
                    <h2>XEM CHI TIẾT PHIẾU</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <ol class="breadcrumb" style="margin-left: 15px;">
                <li style="margin-right: 10px"><a href="/"> <i class="fa fa-home home"></i> Home</a></li>
                <li class="active">
                    <span>Chi tiết</span>
                </li>
            </ol>
        </div>

        <form action="" method="post" id="edit">
            <div class="form-group">
                <input type="hidden" class="form-control" id="id" value="@Model.id" />
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-8 text-center">
                        <h2><label>BẢNG THÔNG TIN CHUNG VỀ SẢN PHẨM</label></h2>
                    </div>
                    <div class="col-md-2 m-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Số LSX: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="so_lenh_sx" value="@Model.so_lenh_sx" />
                        <div class="valid" style="color: red; font-style: italic;">
                            <div class="textNoti" id="textvalid">
                                <!--hiển thị thông báo-->
                            </div>
                        </div>

                    </div>

                    <div class="col-md-2 text-right">
                        <label>Ngày: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="created_date" value="@(Model.created_date.HasValue?Model.created_date.Value.ToString("dd/MM/yyyy") : "")" placeholder="dd/MM/yyyy" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Loại: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="loai" value="@Model.loai" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Lần sửa dổi: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="number" min="0" class="form-control" id="lan_dieu_chinh" value="@Model.lan_dieu_chinh" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Phiếu ĐNSX số: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="phieu_dnsx_so" value="@Model.phieu_dnsx_so" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Nhân Viên Kinh Doanh: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="nv_kinh_doanh" value="@Model.nv_kinh_doanh" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Mã khách hàng: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ma_khach_hang" value="@Model.ma_khach_hang" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Tên khách hàng: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ten_khach_hang" value="@Model.ten_khach_hang" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Mã sản phẩm: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ma_san_pham" value="@Model.ma_san_pham" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Tên sản phẩm: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ten_san_pham" value="@Model.ten_san_pham" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Nhà cung cấp vật tư: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="nha_cc" value="@Model.nha_cc" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Khổ TP: </label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control idecimal" id="kho_doc" value="@Model.kho_doc" placeholder="Dài" />
                    </div>

                    <div class="col-md-2">
                        <input type="text" class="form-control idecimal" id="kho_ngang" value="@Model.kho_ngang" placeholder="Rộng" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-2 text-right">
                        <label>Ngày giao hàng: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ngay_giao_hangMH3" value="@(Model.ngay_giao_hang.HasValue ? Model.ngay_giao_hang.Value.ToString("dd/MM/yyyy"): "")" placeholder="dd/MM/yyyy" />
                    </div>
                    <div class="col-md-3"></div>
                </div>

                <hr />

                <!--Bảng nội dung CTP-->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>NỘI DUNG CTP</u>
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered info-materials" id="appendixTable">
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" rowspan="2" style="width: 50px;">STT</th>
                                            <th class="text-center" rowspan="2" style="width: 150px;">Nhóm vật tư</th>
                                            <th class="text-center" rowspan="2" style="width: 270px;">Tay in</th>
                                            <th class="text-center" rowspan="2" style="width: 100px">Trang</th>
                                            <th class="text-center" rowspan="2" style="width: 100px">Loại giấy</th>
                                            <th class="text-center" rowspan="2" style="width: 120px">Định lượng giấy</th>
                                            <th class="text-center" colspan="2">Kiểu in</th>
                                            <th class="text-center" rowspan="2" style="width: 200px">Ghi chú</th>
                                            <th class="text-center" rowspan="2" style="width: 50px;">
                                                <a class="btn btn-sm btn-primary lock p5" id="addRowAppendixTable" title="Thêm mới">
                                                    <i class="fa fa-plus"></i>
                                                </a>
                                            </th>
                                        </tr>
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" style="width: 120px">Kiểu in trên</th>
                                            <th class="text-center" style="width: 120px">Kiểu in dưới</th>
                                        </tr>

                                        <tbody id="appendixTbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Quy cách chung: </label>
                    </div>
                    <div class="col-md-10">
                        @Html.TextAreaFor(a=>a.quy_cach_chung, new Dictionary<string, object>
                              {
                                  {"class", " form-control"},
                                    {"id", "quy_cach_chung"},
                                     { "maxlength", "2001" },
                                     { "row", "3" },
                              })
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Nhân viên quản lý đơn hàng: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ten_can_bo_ql" value="@Model.ten_can_bo_ql" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Số điện thoại: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="phone_number" value="@Model.phone_number" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2 text-right">
                        <label>Email: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="email" value="@Model.email" />
                    </div>

                    <div class="col-md-2 text-right">
                        <label>Người duyệt: </label>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="ten_can_bo_kt" value="@Model.ten_can_bo_kt" />
                    </div>
                </div>
                <hr />
                <!--//////////////////////////////End tổng quan đơn hàng, start dự toán vật tư/////////////////////////////-->

                <div class="row" style="margin-top:40px;">
                    <div class="col-md-2"></div>
                    <div class="col-md-8 text-center">
                        <h2><label>BẢNG DỰ TOÁN VẬT TƯ SẢN XUẤT</label></h2>
                    </div>
                    <div class="col-md-2"></div>
                </div>

                <!--Bảng nội dung dự toán-->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>BẢNG DỰ TOÁN VẬT TƯ</u>
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered info-materials" id="appendixTableMH2">
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" rowspan="3" style="width:40px">STT</th>
                                            <th class="text-center" rowspan="3" style="width:50px">Số lượng(tờ)</th>
                                            <th class="text-center" colspan="4" style="width:320px">Quy cách loại vật tư</th>
                                            <th class="text-center" rowspan="3" style="width:50px">Trang/tờ</th>
                                            <th class="text-center" rowspan="3" style="width:60px">Định mức</th>
                                            <th class="text-center" colspan="5" style="width:240px">Số lượng</th>
                                            <th class="text-center" rowspan="3" style="width:60px">Quy ký</th>
                                            <th class="text-center" rowspan="3" style="width:110px">Mục đích sử dụng</th>
                                            <th class="text-center" style="width:40px;" rowspan="3">
                                                <a class="btn btn-sm btn-primary lock p5" id="addRowAppendixTableMH2" title="Thêm mới">
                                                    <i class="fa fa-plus"></i>
                                                </a>
                                            </th>
                                        </tr>
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" rowspan="2" style="width:130px">Vật tư</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Định lượng giấy</th>
                                            <th class="text-center" colspan="2" style="width:120px">Khổ giấy</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Chính</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Bù in</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Bù TP</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Bù phát hành</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Tổng</th>
                                        </tr>
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" style="width:60px">Dài</th>
                                            <th class="text-center" style="width:60px">Rộng</th>
                                        </tr>

                                        <tbody id="appendixTbodyMH2"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
                <!--//////////////////////////////End dự toán vật tư, start lệnh sản xuất/////////////////////////////-->

                <div class="row" style="margin-top:40px;">
                    <div class="col-md-2"></div>
                    <div class="col-md-8 text-center">
                        <h2><label>BẢNG LỆNH SẢN XUẤT</label></h2>
                    </div>
                    <div class="col-md-2"></div>
                </div>

                <!--Bảng số lượng tổng-->
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-6 margin-top-10">
                        <div class="table-responsive" style="border: 1px solid black !important;overflow-y: hidden;overflow-x: hidden;">
                            <table class="table table-striped table-bordered info-materials" id="printTableSLTong" style="margin-bottom:0px !important">
                                <tr style="background-color: white; color: black;">
                                    <th class="text-center" style="width:30px">STT</th>
                                    <th class="text-center" style="width:250px">
                                        <div class="row">
                                            <div class="col-md-3 text-left">
                                                <label>Số lượng tổng:</label>
                                            </div>
                                            <div class="col-md-9 text-left">
                                                <input type="text" class="form-control iinteger" id="so_luong_tong" value="@Model.so_luong_tong" />
                                            </div>
                                        </div>

                                    </th>
                                    <th class="text-center" style="width:30px;">
                                        <a class="btn btn-sm btn-primary lock p5" id="addRowSLTong" title="Thêm mới">
                                            <i class="fa fa-plus"></i>
                                        </a>
                                    </th>
                                </tr>

                                <tbody id="appendixPrintTbodySLTong"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-3"></div>
                </div>

                <hr />

                <!--I. Quy cách sản phẩm -->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>I. QUY CÁCH SP</u>
                                </label>
                            </div>
                        </div>

                    </div>
                </div>

                <hr />

                <!--Bảng nội dung Chế bản-->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>II. CHẾ BẢN</u>
                                </label>
                            </div>
                        </div>

                        <div class="row span">
                            <div class="col-md-2">
                                <label>Thời gian giao file:</label>
                            </div>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="cb_thoi_gian_giao" value="@Model.cb_thoi_gian_giao" />
                            </div>
                        </div>

                        <div class="row span">
                            <div class="col-md-2">
                                <label>Ghi chú đặc biệt:</label>
                            </div>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="cb_ghi_chu" value="@Model.cb_ghi_chu" />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered info-materials" id="appendixTableMH3">
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" rowspan="2" style="width:40px">STT</th>
                                            <th class="text-center" rowspan="2" style="width:250px">Tay in</th>
                                            <th class="text-center" rowspan="2" style="width:120px">Số kẽm</th>
                                            <th class="text-center" rowspan="2" style="width:120px">Số bộ</th>
                                            <th class="text-center" rowspan="2" style="width:120px">Tổng</th>
                                            <th class="text-center" rowspan="2" style="width:150px">Trang/khổ in</th>
                                            <th class="text-center" colspan="2" style="width:120px">Khổ in</th>
                                            <th class="text-center" rowspan="2" style="width:120px">Khổ kẽm</th>
                                            <th class="text-center" rowspan="2" style="width:150px">PP in</th>
                                            <th class="text-center" rowspan="2" style="width:40px;">
                                                <a class="btn btn-sm btn-primary lock p5" id="addRowAppendixTableMH3" title="Thêm mới">
                                                    <i class="fa fa-plus"></i>
                                                </a>
                                            </th>
                                        </tr>
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" style="width:60px">Dài</th>
                                            <th class="text-center" style="width:60px">Rộng</th>
                                        </tr>

                                        <tbody id="appendixTbodyMH3"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <hr />

                <!--Bảng In-->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>III. IN</u>
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2">
                                <label>Ghi chú đặc biệt:</label>
                            </div>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="in_ghi_chu" value="@Model.in_ghi_chu" />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered info-materials" id="printTable">
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" rowspan="2" style="width:40px">STT</th>
                                            <th class="text-center" rowspan="2" style="width:160px">Tay in</th>
                                            <th class="text-center" rowspan="2" style="width:80px">Loại giấy</th>
                                            <th class="text-center" rowspan="2" style="width:60px">Định lượng</th>
                                            <th class="text-center" colspan="2" style="width:120px">Khổ giấy</th>
                                            <th class="text-center" colspan="2" style="width:120px">Khổ in</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Chính</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Bù in</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Bù TP</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Bù phát hành</th>
                                            <th class="text-center" rowspan="2" style="width:80px">Tổng</th>
                                            <th class="text-center" rowspan="2" style="width:90px">PP in</th>
                                            <th class="text-center" rowspan="2" style="width:80px">Số kg</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Số lượt in quy đổi</th>
                                            <th class="text-center" rowspan="2" style="width:70px">Số lượt in thực tế</th>
                                            <th class="text-center" rowspan="2" style="width:40px;">
                                                <a class="btn btn-sm btn-primary lock p5" id="addRowprintTable" title="Thêm mới">
                                                    <i class="fa fa-plus"></i>
                                                </a>
                                            </th>
                                        </tr>
                                        <tr style="background-color: #0076d2; color: white;">
                                            <th class="text-center" style="width:60px">Dài</th>
                                            <th class="text-center" style="width:60px">Rộng</th>
                                            <th class="text-center" style="width:60px">Dài</th>
                                            <th class="text-center" style="width:60px">Rộng</th>
                                        </tr>

                                        <tbody id="appendixPrintTbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <hr />
                <!--IV Thành phẩm-->
                <div class="group">
                    <div class="form-body">
                        <div class="row span">
                            <div class="col-md-12">
                                <label class="caption-subject sbold uppercase" style="font-size:20px;">
                                    <u>IV. THÀNH PHẨM</u>
                                </label>
                            </div>
                        </div>


                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-8">
                        <div class="table-responsive" @*style="overflow-y: hidden;overflow-x: hidden;"*@>
                            <table class="table table-striped table-bordered">
                                <tr style="background-color: #0076d2; color: white;">
                                    <th class="text-center" colspan="4">Quy cách</th>
                                    <th class="text-center" rowspan="2" style="width: 200px">Số lượng</th>
                                    <th class="text-center" rowspan="2" style="width: 150px">Số cuốn/thùng</th>
                                    <th class="text-center" rowspan="2" style="width: 100px">Đơn vị tính</th>
                                </tr>
                                <tr style="background-color: #0076d2; color: white;">
                                    <th class="text-center" style="width: 205px">Vật tư</th>
                                    <th class="text-center" style="width: 140px">Dài</th>
                                    <th class="text-center" style="width: 140px">Rộng</th>
                                    <th class="text-center" style="width: 140px">Cao</th>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <select class="form-control text-center" id="tp_thung" onchange="AutoFillDungCongThuc(this)">
                                            <option value="1" selected title="Có dùng công thức">Thùng</option>
                                            <option value="2" title="Không dùng công thức">Thùng(Không dùng công thức)</option>
                                        </select>
                                    </td>
                                    <th class="text-center"><input class="form-control idecimal" type="text" value="@Model.tp_dai" id="tp_dai" onchange="AutoTinhSLBangKeo(this)" /></th>
                                    <th class="text-center"><input class="form-control idecimal" type="text" value="@Model.tp_rong" id="tp_rong" onchange="AutoTinhSLBangKeo(this)" /></th>
                                    <th class="text-center"><input class="form-control idecimal" type="text" value="@Model.tp_cao" id="tp_cao" onchange="AutoTinhSLBangKeo(this)" /></th>
                                    <th class="text-center"><input class="form-control iinteger" type="text" value="@Model.tp_soluong" id="tp_soluong" disabled /></th>
                                    <th class="text-center"><input class="form-control iinteger" type="text" value="@Model.tp_socuon_thung" id="tp_socuon_thung" onchange="AutoFillTPSoLuong()" /></th>
                                    <td class="text-center">Thùng</td>
                                </tr>

                                <tr>
                                    <th class="text-center">
                                        <select class="form-control text-center" name="bangkeo" id="bangkeo" onchange="AutoFillTPSoLuongBangKeo(this)">
                                            <option value="" disabled selected hidden>--Chọn--</option>
                                            <option value="1" @(Model.tp_vat_tu == 1 ? "selected" : "") title="Công thức tính số lượng: ((dài * 2) + ((rộng + cao) * 4) + 60)/100 * số thùng">Băng keo</option>
                                            <option value="2" @(Model.tp_vat_tu == 2 ? "selected" : "") title="Công thức tính số lượng: (dài + rộng + 40) * 2 / 100 * số thùng">Băng keo đặc biệt</option>
                                        </select>
                                    </th>
                                    <th class="text-center" colspan="3"><input disabled class="form-control" /></th>
                                    <th class="text-center"><input class="form-control iinteger" type="text" value="@Model.tp_sl_bangkeo" id="tp_sl_bangkeo" disabled /></th>
                                    <th class="text-center"><input disabled class="form-control" /></th>
                                    <td class="text-center">Mét</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-2"></div>
                </div>

                <div class="row">
                    <div class="col-md-2">
                        <label class="margin-top-40">Thành phẩm chung:</label>
                    </div>

                    <div class="col-md-10">
                        @Html.TextAreaFor(a=>a.thanh_pham_chung, new Dictionary<string, object>
                              {
                                  {"class", " form-control"},
                                    {"id", "thanh_pham_chung"},
                                     { "maxlength", "2000" },
                                     { "row", "3" },
                              })
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2">
                        <label class="margin-top-40">Ghi chú đặc biệt:</label>
                    </div>
                    <div class="col-md-10">
                        @Html.TextAreaFor(a=>a.tp_ghi_chu, new Dictionary<string, object>
                              {
                                  {"class", " form-control"},
                                    {"id", "tp_ghi_chu"},
                                     { "maxlength", "2000" },
                                     { "row", "3" },
                              })
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2">
                        <label>Thời hạn giao thành phẩm:</label>
                    </div>
                    <div class="col-md-10">
                        <input type="text" class="form-control" id="tp_thoi_han" value="@Model.tp_thoi_han" />
                    </div>

                </div>

                @*<div class="row">
                        <div class="col-md-2">
                            <label>Người lập lệnh sản xuất:</label>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="ten_can_bo_qlMH3" disabled value="@Model.ten_can_bo_ql" />
                        </div>

                        <div class="col-md-2 text-right">
                            <label>Người duyệt:</label>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="ten_can_bo_ktMH3" disabled value="@Model.ten_can_bo_kt" />
                        </div>
                    </div>*@

            </div>
        </form>

        <div class="row" style="margin-top: 15px">
            <div class="col-md-12 text-right">
                <a href="/Material" class="btn btn-primary" style="min-width: 6%"> Quay lại</a>
                <a onclick="AddOrUpdateAllScreen()" class="btn btn-success" style="width: 6%; color:white">Lưu</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal content-->
<div class="modal" id="Modal-StageTranfer" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-center" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle"><b>Thêm mới nhóm vật tư</b></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="row">
                    <div class="col-md-12">
                        <label for="displayOrder">Tên nhóm vật tư</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="materialTypeName" />
                        </div>
                        <div style="margin-top: 5px; color: red; font-style: italic;" id="notiMaterialName">

                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" style="background-color: red;" data-dismiss="modal">Đóng</button>
                <button onclick="UpdateMaterialType()" type="button" class="btn btn-primary">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!--Js file-->
<script src="~/assets/login/vendor/datepicker/moment.min.js"></script>
<script src="~/Scripts/bootbox.min.js"></script>
<script src="~/assets/vendor/jquery/1.7.1/jquery.min.js"></script>
<script src="~/Scripts/JSLINQ-vsdoc.js"></script>
<script src="~/Scripts/JSLINQ.js"></script>

@section scripts {
    <script src="~/Scripts/input-mask/jquery.inputmask.js"></script>
    <script src="~/Scripts/TPlugin/TPlugin.js"></script>
    <script type="text/javascript">

        var lstMaterialType = @Html.Raw(Json.Encode(Model.lstMaterialType));
        var lstlstPPIn = @Html.Raw(Json.Encode(Model.lstPPIn));
        var lstKhoKem = @Html.Raw(Json.Encode(Model.lstkhoKem));
        var lstAppendix = @Html.Raw(Json.Encode(Model.lstVatTus));
        var lstAppendixMH2 = @Html.Raw(Json.Encode(Model.lstChiTietDuToans));
        var lstAppendixMH3 = @Html.Raw(Json.Encode(Model.lstChiTietCheBans));
        var lstAppendixPrint = @Html.Raw(Json.Encode(Model.lstChiTietIns));
        var lstAppenSLTong = @Html.Raw(Json.Encode(Model.lst_sl_tong));
        var lstBangCheBanMH3 = [];

        ///////////////////////////////////////Man hinh 1 ///////////////////////////////////////////////
        // Input mask
        $("#so_lenh_sx").soLenhSXMask();
        $("#phieu_dnsx_so").phieuDNSXMask();

        function formatDocument() {
            $(".idecimal").decimalMask(2);
            $(".iinteger").decimalMask(0);
            $(".idecimal3").decimalMask(3);
            $(".iupper").upperMask();
            $(".istrupper").upperStringMask();
        }

        $(document).ready(function () {

            $("#edit").submit(function () {
                return false;
            });
            $("#editMH2").submit(function () {
                return false;
            });
            $("#editMH3").submit(function () {
                return false;
            });

            $("#created_date").datepicker({
                dateFormat: 'dd/mm/yy'
            }).datepicker("setDate", new Date());

            $("#ngay_giao_hangMH3").datepicker({
                dateFormat: 'dd/mm/yy'
            }).datepicker("setDate", new Date());

            $("input#created_date").on({
                keydown: function (e) {
                    if (e.which === 8 || e.which === 46)
                        return true;
                    return false;
                },
            });

            $("input#ngay_giao_hangMH3").on({
                keydown: function (e) {
                    if (e.which === 8 || e.which === 46)
                        return true;
                    return false;
                },
            });

            var html = generateHtmlAppendix(lstAppendix);
            $('#appendixTbody').html(html);

            var htmlDuToan = generateHtmlAppendMH2(lstAppendixMH2);
            $('#appendixTbodyMH2').html(htmlDuToan);

            var htmlCheBan = generateHtmlAppendixMH3(lstAppendixMH3);
            $('#appendixTbodyMH3').html(htmlCheBan);

            var htmlIn = generateHtmlAppendixPrint(lstAppendixPrint);
            $('#appendixPrintTbody').html(htmlIn);

            var htmlSLTong = generateHtmlAppendSoLuongTong(lstAppenSLTong);
            $('#appendixPrintTbodySLTong').html(htmlSLTong);

            formatDocument()

            $(".selcted2").select2({
                theme: "bootstrap",
                cache: true,
                dropdownAutoWidth: true,
                ajax: {
                    url: '/Material/Search',
                    dataType: 'json',
                    delay: 250,
                    cache: true,
                    dropdownAutoWidth: true,
                    processResults: function (data) {
                        var results = [{ id: -1, text: '--Thêm mới--' }];
                        results.push(...data.map(o => {
                            return { id: o.Id, text: `${o.MaterialTypeName}` }
                        }));
                        return {
                            results: results
                        };
                    }
                }
            }).on('change', function (e) {
                if ($(e.target).val() * 1 === -1) {
                    $(e.target).val('');
                    $('#Modal-StageTranfer').modal('show');
                    $('#notiMaterialName').empty();
                    $('body').removeClass('modal-open');
                    $('.modal-backdrop').remove();
                }
                });

        });

        function generateHtmlAppendix(lstAppendix) {
            var htmlAllRows = '';
            for (var i = 0; i < lstAppendix.length; i++) {
                htmlAllRows = htmlAllRows + generateHtmlAppendixRow(lstAppendix[i], i);
            }
            formatDocument();
            return htmlAllRows;
        }

        function generate(appendix, index) {
            var htmlRow = `<select class="form-control nhom_vat_tu_id selcted2" required style="width: 100%">`;
            htmlRow += `<option value="" ${appendix.nhom_vat_tu_id == '' ? 'selected' : ''}>---Chọn---</option > `;
            for (var i = 0; i < lstMaterialType.length; i++) {
                htmlRow += `<option value = "${lstMaterialType[i].Id}" ${lstMaterialType[i].Id == appendix.nhom_vat_tu_id ? 'selected' : ''}> ${lstMaterialType[i].MaterialTypeName}</option> `;
            }
            htmlRow += `</select>`
            return htmlRow;
        }

        function generateHtmlAppendixRow(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                                <td id="STT" class="text-center">${index + 1}</td>
                                <td>
                                    ${generate(appendix, index)}
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText ten" value="${appendix.ten == null ? '' : appendix.ten}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText trang iinteger" value="${appendix.trang == null ? '' : appendix.trang}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText loai_giay" oninput="AutocompleteLoaiGiay(this)" value="${appendix.loai_giay == null ? '' : appendix.loai_giay}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText dinh_luong_giay idecimal" value="${appendix.dinh_luong_giay == null ? '' : appendix.dinh_luong_giay}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText kieu_in_1 iinteger" value="${appendix.kieu_in_1 == null ? '' : appendix.kieu_in_1}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText kieu_in_2 iinteger" value="${appendix.kieu_in_2 == null ? '' : appendix.kieu_in_2}" />
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText ghi_chu" value="${appendix.ghi_chu == null ? '' : appendix.ghi_chu}" />
                                </td>
                                <td class="text-center">
                                    <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" style"background-color: white !important;" onclick="removeAppendixRow(this)" id="removeAppendixRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </td>
                            </tr>`
        }


        $("#addRowAppendixTable").click(function () {
            var appendix = {
                ten: '',
                nhom_vat_tu_id: '',
                trang: '',
                loai_giay: '',
                dinh_luong_giay: '',
                kieu_in_1: '',
                kieu_in_2: '',
                ghi_chu: '',
            };
            var htmlRow = generateHtmlAppendixRow(appendix, lstAppendix.length)
            $("#appendixTable #appendixTbody").append(htmlRow);
            lstAppendix.push(appendix);
            if (lstAppendix.length > 1000) {
                $("#addRowAppendixTable").prop("disabled", true);
            }
            else {
                $("#addRowAppendixTable").prop("disabled", false);
            }
            $(".selcted2").select2({
                theme: "bootstrap",
                cache: true,
                dropdownAutoWidth: true,
                ajax: {
                    url: '/Material/Search',
                    dataType: 'json',
                    delay: 250,
                    cache: true,
                    dropdownAutoWidth: true,
                    processResults: function (data) {
                        var results = [{ id: -1, text: '--Thêm mới--' }];
                        results.push(...data.map(o => {
                            return { id: o.Id, text: `${o.MaterialTypeName}` }
                        }));
                        return {
                            results: results
                        };
                    }
                }
            }).on('change', function (e) {
                if ($(e.target).val() * 1 === -1) {
                    $(e.target).val('');
                    $('#Modal-StageTranfer').modal('show');
                    $('#notiMaterialName').empty();
                    $('body').removeClass('modal-open');
                    $('.modal-backdrop').remove();
                }
                });
        });


        function removeAppendixRow(element) {
            var row = parseInt($(element).attr("myid"));
            $(element).parent().parent().remove();
            lstAppendix.splice(row - 1, 1);
            if (row <= lstAppendix.length) {
                for (r = row + 1; r <= lstAppendix.length + 1; r++) {
                    $("#appendixTable #standard_" + r + " #STT").text(row);

                    $("#appendixTable #standard_" + r + " .ac").removeAttr("myid");
                    $("#appendixTable #standard_" + r + " .ac").attr("myid", "re_" + row);
                    $("#appendixTable #standard_" + r + " .ac").attr("id", "ac_" + row);

                    $("#appendixTable #standard_" + r + " .re").removeAttr("myid");
                    $("#appendixTable #standard_" + r + " .re").attr("myid", "ac_" + row);
                    $("#appendixTable #standard_" + r + " .re").attr("id", "re_" + row);

                    $("#appendixTable #standard_" + r + " .appendix-row").removeAttr("myid");
                    $("#appendixTable #standard_" + r + " .appendix-row").attr("myid", row);
                    $("#appendixTable #standard_" + r + " .appendix-row").attr("id", "removeAppendixRow_" + row);

                    $("#appendixTable #standard_" + r).attr("id", "standard_" + row);
                    row = row + 1;
                }
            }
        }


        function UpdateMaterialType() {
            $('#notiMaterialName').empty();

            var materialTypeName = $('#materialTypeName').val().trim();

            if (materialTypeName == null || materialTypeName == "" || materialTypeName == ' ') {
                $('#notiMaterialName').html('Tên nhóm vật tư không được để trống')
                return false;
            }
            var data = {
                Id: 0,
                MaterialTypeName: $('#materialTypeName').val().trim(),
            };
            var url = '/Material/UpdateMaterialType';
            $.ajax({
                url: "/Material/CheckDuplicatedMaterialName/",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: `{'MaterialTypeName':'${data.MaterialTypeName}', 'id':'${data.Id}'}`,
                success: function (result) {
                    if (result == true) {
                        $.post(url, data,
                            function (rs) {
                                if (rs == 1) {
                                    toastr.success('Thêm mới thành công');
                                    $('#Modal-StageTranfer').modal('hide');
                                } else { toastr.error('Thêm mới thất bại'); }
                            });
                    }
                    else {
                        $('#notiMaterialName').html('Tên nhóm vật tư đã bị trùng')
                        return false;
                    }
                }
            });
        }

        $(".selcted2").select2({
            theme: "bootstrap",
            cache: true,
            dropdownAutoWidth: true,
            ajax: {
                url: '/Material/Search',
                dataType: 'json',
                delay: 250,
                cache: true,
                dropdownAutoWidth: true,
                processResults: function (data) {
                    var results = [{ id: -1, text: '--Thêm mới--' }];
                    results.push(...data.map(o => {
                        return { id: o.Id, text: `${o.MaterialTypeName}` }
                    }));
                    return {
                        results: results
                    };
                }
            }
        }).on('change', function (e) {
            if ($(e.target).val() * 1 === -1) {
                $(e.target).val('');
                $('#Modal-StageTranfer').modal('show');
                $('#notiMaterialName').empty();
                $('body').removeClass('modal-open');
                $('.modal-backdrop').remove();
            }
        });

        function AutocompleteLoaiGiay(element) {
            var value = $(element).val();
            $(element).autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: "/Material/SearchLoaiGiayAutoComplete",
                        data: "{'keySearch':'" + value + "'}",
                        success: function (rs) {
                            response(rs);
                        },
                        error: function (result) {
                            alert("No Match");
                        }
                    });
                }
            });
        }

        function SearchMaKHAutoComplete(element) {
            var value = $(element).val();
            $(element).autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: "/Material/SearchMaKHAutoComplete",
                        data: "{'keySearch':'" + value + "'}",
                        success: function (rs) {
                            response(rs);
                        },
                        error: function (result) {
                            alert("No Match");
                        }
                    });
                }
            });
        }

        function SearchTenKHAutoComplete(element) {
            var value = $(element).val();
            $(element).autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: "/Material/SearchTenKHAutoComplete",
                        data: "{'keySearch':'" + value + "'}",
                        success: function (rs) {
                            response(rs);
                        },
                        error: function (result) {
                            alert("No Match");
                        }
                    });
                }
            });
        }

        function SearchMaSPAutoComplete(element) {
            var value = $(element).val();
            $(element).autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: "/Material/SearchMaSPAutoComplete",
                        data: "{'keySearch':'" + value + "'}",
                        success: function (rs) {
                            response(rs);
                        },
                        error: function (result) {
                            alert("No Match");
                        }
                    });
                }
            });
        }

        function SearchTenSPAutoComplete(element) {
            var value = $(element).val();
            $(element).autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        url: "/Material/SearchTenSPAutoComplete",
                        data: "{'keySearch':'" + value + "'}",
                        success: function (rs) {
                            response(rs);
                        },
                        error: function (result) {
                            alert("No Match");
                        }
                    });
                }
            });
        }

        function TrimValue(element) {
            var value = $(element).val().trim();
            $(element).val(value);
        }

        //Lấy thông tin details bảng tổng quan
        function GetInfoDetail() {
            lstContents = [];
            for (var i = 0; i < lstAppendix.length; i++) {
                var contents = {
                    ten: $('#standard_' + (i + 1) + ' .ten').val().toString().trim(),
                    nhom_vat_tu_id: $('#standard_' + (i + 1) + ' .nhom_vat_tu_id').val(),
                    ten_nhom_vat_tu: ($('#standard_' + (i + 1) + ' .nhom_vat_tu_id').val() == "" ? "" : $('#standard_' + (i + 1) + ' .nhom_vat_tu_id option:selected').text().trim()),
                    trang: $('#standard_' + (i + 1) + ' .trang').val(),
                    loai_giay: $('#standard_' + (i + 1) + ' .loai_giay').val().trim(),
                    dinh_luong_giay: $('#standard_' + (i + 1) + ' .dinh_luong_giay').val(),
                    kieu_in_1: $('#standard_' + (i + 1) + ' .kieu_in_1').val(),
                    kieu_in_2: $('#standard_' + (i + 1) + ' .kieu_in_2').val(),
                    ghi_chu: $('#standard_' + (i + 1) + ' .ghi_chu').val().trim(),
                };
                lstContents.push(contents);
            };
            return lstContents;
        }

        //Lấy thông tin details bảng dự toán
        function GetInfoChiTietDuToan() {
            lstContents = [];
            for (var i = 0; i < lstAppendixMH2.length; i++) {
                var contents = {
                    vat_tu_id: $('#standard_' + (i + 1) + ' .vat_tu_idMH2').val(),
                    so_luong: $('#standard_' + (i + 1) + ' .so_luongMH2').val(),
                    ten: $('#standard_' + (i + 1) + ' .tenMH2').val().trim(),
                    dinh_luong: $('#standard_' + (i + 1) + ' .dinh_luongMH2').val(),
                    kho_giay_dai: $('#standard_' + (i + 1) + ' .kho_giay_daiMH2').val(),
                    kho_giay_rong: $('#standard_' + (i + 1) + ' .kho_giay_rongMH2').val(),
                    trang: $('#standard_' + (i + 1) + ' .trangMH2').val(),
                    dinh_muc: $('#standard_' + (i + 1) + ' .dinh_mucMH2').val(),
                    sl_chinh: $('#standard_' + (i + 1) + ' .sl_chinhMH2').val(),
                    sl_bu_in: $('#standard_' + (i + 1) + ' .sl_bu_inMH2').val(),
                    sl_bu_tp: $('#standard_' + (i + 1) + ' .sl_bu_tpMH2').val(),
                    bu_phat_hanh: $('#standard_' + (i + 1) + ' .bu_phat_hanhMH2').val(),
                    sl_tong: $('#standard_' + (i + 1) + ' .sl_tongMH2').val(),
                    quy_ky: $('#standard_' + (i + 1) + ' .quy_kyMH2').val(),
                    muc_dich_sd: $('#standard_' + (i + 1) + ' .muc_dich_sdMH2').val(),
                    loai_giay: $('#standard_' + (i + 1) + ' .loai_giayMH2').val(),
                };
                lstContents.push(contents);
            };
            return lstContents;
        }

        //Lấy thông tin details bảng số lượng tổng
        function GetInfoSoLuongTong() {
            lstContents = [];
            for (var i = 0; i < lstAppenSLTong.length; i++) {
                var contents = {
                    Values: $('#standard_' + (i + 1) + ' .Values').val().toString().trim(),
                };
                lstContents.push(contents);
            };
            return lstContents;
        }

        //Lấy thông tin details bảng chế phẩm
        function GetInfoChiTietCheBan() {
            lstContents = [];
            for (var i = 0; i < lstAppendixMH3.length; i++) {
                var contents = {
                    vat_tu_id: $('#standard_' + (i + 1) + ' .vat_tu_id1').val().trim(),
                    ten_tay_in: $('#standard_' + (i + 1) + ' .ten_tay_in1').val().trim(),
                    so_kem: $('#standard_' + (i + 1) + ' .so_kem1').val().toString(),
                    so_bo: $('#standard_' + (i + 1) + ' .so_bo1').val().toString().trim(),
                    tong: $('#standard_' + (i + 1) + ' .tong1').val().toString().trim(),
                    trang: $('#standard_' + (i + 1) + ' .trang1').val().toString().trim(),
                    kho_in_dai: $('#standard_' + (i + 1) + ' .kho_in_dai1').val().toString().trim(),
                    kho_in_rong: $('#standard_' + (i + 1) + ' .kho_in_rong1').val().toString().trim(),
                    kho_kem: $('#standard_' + (i + 1) + ' .kho_kem1').val() * 1,
                    phuong_phap_in: $('#standard_' + (i + 1) + ' .phuong_phap_in1').val(),
                };
                lstContents.push(contents);
            };
            return lstContents;
        }

        //Lấy thông tin details bảng In
        function GetInfoChiTietBangIn() {
            lstContents = [];
            for (var i = 0; i < lstAppendixPrint.length; i++) {
                var contents = {
                    vat_tu_id: $('#standard_' + (i + 1) + ' .vat_tu_id').val().trim(),
                    ten_tay_in: $('#standard_' + (i + 1) + ' .ten_tay_in').val().trim(),
                    ten_loai: $('#standard_' + (i + 1) + ' .ten_loai').val().trim(),
                    dinh_luong_giay_in: $('#standard_' + (i + 1) + ' .dinh_luong_giay_in').val(),
                    kho_giay_dai: $('#standard_' + (i + 1) + ' .kho_giay_dai').val(),
                    kho_giay_rong: $('#standard_' + (i + 1) + ' .kho_giay_rong').val(),
                    kho_in_dai: $('#standard_' + (i + 1) + ' .kho_in_dai').val(),
                    kho_in_rong: $('#standard_' + (i + 1) + ' .kho_in_rong').val(),
                    chinh: $('#standard_' + (i + 1) + ' .chinh').val(),
                    bu_in: $('#standard_' + (i + 1) + ' .bu_in').val(),
                    bu_thanh_pham: $('#standard_' + (i + 1) + ' .bu_thanh_pham').val(),
                    bu_phat_hanh: $('#standard_' + (i + 1) + ' .bu_phat_hanh').val(),
                    sl_tong: $('#standard_' + (i + 1) + ' .sl_tong').val(),
                    phuong_phap_in: $('#standard_' + (i + 1) + ' .phuong_phap_in').val(),
                    so_kg: $('#standard_' + (i + 1) + ' .so_kg').val(),
                    so_luot_in_quy_doi: $('#standard_' + (i + 1) + ' .so_luot_in_quy_doi').val(),
                    so_luot_in_thuc_te: $('#standard_' + (i + 1) + ' .so_luot_in_thuc_te').val(),
                };
                lstContents.push(contents);
            };
            return lstContents;
        }

        $("input#lan_dieu_chinh").on({
            keydown: function (e) {
                if (e.which === 69)
                    return false;
            },
        });

        ///////////////////////// Man hinh 2 //////////////////////////////////////

        function generateHtmlAppendMH2(lstAppenMH2) {
            var htmlAllRows = '';
            for (var i = 0; i < lstAppenMH2.length; i++) {
                htmlAllRows = htmlAllRows + generateHtmlAppendixRowMK2(lstAppenMH2[i], i);
            }
            return htmlAllRows;
        }

        function generateHtmlAppendixRowMK2(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                                <td id="STT" class="text-center">${index + 1}</td>
                                <td style="display:none;">
                                    <input type="number" style="display:none;" class="form-control inputText vat_tu_idMH2" value="${appendix.vat_tu_id == null ? '' : appendix.vat_tu_id}" id="vattuidMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control iinteger inputText so_luongMH2" onchange="AutoTinhSoLuongChinh(this)" value="${appendix.so_luong == null ? '' : appendix.so_luong}" id="soluongMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText tenMH2" value="${appendix.ten == null ? '' : appendix.ten}" id="tenMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText dinh_luongMH2" onchange="AutoTinhQuyKy(this)" value="${appendix.dinh_luong == null ? '' : appendix.dinh_luong}" id="dinhluongMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText kho_giay_daiMH2" onchange="AutoTinhQuyKy(this)" value="${appendix.kho_giay_dai == null ? '' : appendix.kho_giay_dai}" id="khogiaydaiMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText kho_giay_rongMH2" onchange="AutoTinhQuyKy(this)" value="${appendix.kho_giay_rong == null ? '' : appendix.kho_giay_rong}" id="khogiayrongMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control iinteger inputText trangMH2" onchange="AutoTinhDinhMuc(this)" value="${appendix.trang == null ? '' : appendix.trang}" id="trangMH2_${index + 1}"/>
                                </td>
                                <td style="display:none;">
                                    <input type="text" style="display:none;" class="form-control iinteger inputText trangMH1" value="${appendix.trangMH1 == null ? '' : appendix.trangMH1}" id="trangMH1MH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal3 inputText dinh_mucMH2" onchange="AutoTinhSoLuongChinh(this)" value="${appendix.dinh_muc == null ? '' : appendix.dinh_muc}" id="dinhmucMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText sl_chinhMH2" onchange="AutoTinhSoLuongTong(this)" value="${appendix.sl_chinh == null ? '' : appendix.sl_chinh}" id="slchinhMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control iinteger inputText sl_bu_inMH2" onchange="AutoTinhSoLuongTong(this)" value="${appendix.sl_bu_in == null ? '' : appendix.sl_bu_in}" id="slbuinMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control iinteger inputText sl_bu_tpMH2" onchange="AutoTinhSoLuongTong(this)" value="${appendix.sl_bu_tp == null ? '' : appendix.sl_bu_tp}" id="slbutpMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control iinteger inputText bu_phat_hanhMH2" onchange="AutoTinhSoLuongTong(this)" value="${appendix.bu_phat_hanh == null ? '' : appendix.bu_phat_hanh}" id="buphathanhMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText sl_tongMH2" value="${appendix.sl_tong == null ? '' : appendix.sl_tong}" id="sltongMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control idecimal inputText quy_kyMH2" value="${appendix.quy_ky == null ? '' : appendix.quy_ky}" id="quykyMH2_${index + 1}"/>
                                </td>
                                <td>
                                    <input type="text" class="form-control inputText muc_dich_sdMH2" value="${appendix.muc_dich_sd == null ? '' : appendix.muc_dich_sd}" id="mucdichsdMH2_${index + 1}"/>
                                </td>
                                <td style="display:none;">
                                    <input type="text" class="form-control inputText loai_giayMH2" value="${appendix.loai_giay == null ? '' : appendix.loai_giay}" id="loaigiayMH2_${index + 1}"/>
                                </td>
                                <td class="text-center">
                                    <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" onclick="removeAppendixRowMH2(this)" id="removeAppendixRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                      <i class="fa fa-trash"></i>
                                    </a>
                                </td>
                            </tr>`
        }


        $("#addRowAppendixTableMH2").click(function () {
            var appendix = {
                so_luong: '',
                ten: '',
                dinh_luong: '',
                kho_giay_dai: '',
                kho_giay_rong: '',
                ma_vat_tu: '',
                trang: '',
                trangMH1: 1,
                dinh_muc: '',
                sl_chinh: '',
                sl_bu_in: '',
                sl_bu_tp: '',
                sl_tong: '',
                don_vi_tinh: '',
                quy_ky: '',
                muc_dich_sd: '',
                cc_vat_tu: '',
                loai_giay: '',
            };
            var htmlRow = generateHtmlAppendixRowMK2(appendix, lstAppendixMH2.length)
            $("#appendixTableMH2 #appendixTbodyMH2").append(htmlRow);
            lstAppendixMH2.push(appendix);
            if (lstAppendixMH2.length > 1000) {
                $("#addRowAppendixTableMH2").prop("disabled", true);
            }
            else {
                $("#addRowAppendixTableMH2").prop("disabled", false);
            }
        });


        function removeAppendixRowMH2(element) {
            var row = parseInt($(element).attr("myid"));
            $(element).parent().parent().remove();
            lstAppendixMH2.splice(row - 1, 1);
            if (row <= lstAppendixMH2.length) {
                for (r = row + 1; r <= lstAppendixMH2.length + 1; r++) {
                    $("#appendixTableMH2 #standard_" + r + " #STT").text(row);

                    $("#appendixTableMH2 #standard_" + r + " .ac").removeAttr("myid");
                    $("#appendixTableMH2 #standard_" + r + " .ac").attr("myid", "re_" + row);
                    $("#appendixTableMH2 #standard_" + r + " .ac").attr("id", "ac_" + row);

                    $("#appendixTableMH2 #standard_" + r + " .re").removeAttr("myid");
                    $("#appendixTableMH2 #standard_" + r + " .re").attr("myid", "ac_" + row);
                    $("#appendixTableMH2 #standard_" + r + " .re").attr("id", "re_" + row);

                    $("#appendixTableMH2 #standard_" + r + " .appendix-row").removeAttr("myid");
                    $("#appendixTableMH2 #standard_" + r + " .appendix-row").attr("myid", row);
                    $("#appendixTableMH2 #standard_" + r + " .appendix-row").attr("id", "removeAppendixRow_" + row);

                    $("#appendixTableMH2 #standard_" + r).attr("id", "standard_" + row);
                    row = row + 1;
                }
            }
        }

        ////////////////// Man hinh 3 ///////////////////////////////////////////


        ////////bảng in thứ 1 ///////////////////
        function generateHtmlAppendixMH3(lstAppendix) {
            var htmlAllRows = '';
            for (var i = 0; i < lstAppendix.length; i++) {
                htmlAllRows = htmlAllRows + generateHtmlAppendixRowMH3(lstAppendix[i], i);
            }
            return htmlAllRows;
        }

        function generatePPIn(appendix, index) {
            var htmlRow = `<select class="form-control phuong_phap_in1" required style="width: 100%" onchange="FillDataPhuongPhapIn(this)" id="phuongphapin1_${index + 1}">`;
            htmlRow += `<option value="" ${appendix.phuong_phap_in == '' ? 'selected' : ''}>---Chọn---</option > `;
            for (var i = 0; i < lstlstPPIn.length; i++) {
                htmlRow += `<option value = "${lstlstPPIn[i].id}" ${lstlstPPIn[i].id == appendix.phuong_phap_in ? 'selected' : ''}> ${lstlstPPIn[i].Name.trim()}</option> `;
            }
            htmlRow += `</select>`
            return htmlRow;
        }

        function generateKhoKem(appendix, index) {
            var htmlRow = `<select class="form-control kho_kem1" required style="width: 100%" id="khokem1_${index + 1}">`;
            htmlRow += `<option value="" ${appendix.kho_kem == '' ? 'selected' : ''}>---Chọn---</option > `;
            for (var i = 0; i < lstKhoKem.length; i++) {
                htmlRow += `<option value = "${lstKhoKem[i].id}" ${lstKhoKem[i].id == appendix.kho_kem ? 'selected' : ''}> ${lstKhoKem[i].value}</option> `;
            }
            htmlRow += `</select>`
            return htmlRow;
        }

        function generateHtmlAppendixRowMH3(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                            <td id="STT" class="text-center">${index + 1}</td>
                            <td style="display:none;">
                                <input type="text" style="display:none;" class="form-control inputText vat_tu_id1" value="${appendix.vat_tu_id == null ? '' : appendix.vat_tu_id}" id="vattuid1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control inputText ten_tay_in1" value="${appendix.ten_tay_in == null ? '' : appendix.ten_tay_in}" id="tentayin1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_kem1" onchange="AutoFillTongCheBan(this)" value="${appendix.so_kem == null ? '' : appendix.so_kem}" id="sokem1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_bo1" onchange="AutoFillTongCheBan(this)" value="${appendix.so_bo == null ? '' : appendix.so_bo}" id="sobo1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText tong1" value="${appendix.tong == null ? '' : appendix.tong}" id="tong1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText trang1" value="${appendix.trang == null ? '' : appendix.trang}" id="trang1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_in_dai1" onchange="FillDataKhoInDai(this)" value="${appendix.kho_in_dai == null ? '' : appendix.kho_in_dai}" id="khoindai1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_in_rong1" onchange="FillDataKhoInRong(this)" value="${appendix.kho_in_rong == null ? '' : appendix.kho_in_rong}" id="khoinrong1_${index + 1}"/>
                            </td>
                            <td>
                                ${generateKhoKem(appendix, index)}
                            </td>
                            <td>
                                ${generatePPIn(appendix, index)}
                            </td>
                            <td class="text-center">
                                <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" onclick="removeAppendixRowMH3(this)" id="removeAppendixRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>`
        }

        $("#addRowAppendixTableMH3").click(function () {
            var appendix = {
                ten_tay_in: '',
                so_kem: '',
                so_bo: '',
                tong: '',
                trang: '',
                kho_in_dai: '',
                kho_in_rong: '',
                kho_kem: '',
                phuong_phap_in: '',
            };
            var htmlRow = generateHtmlAppendixRowMH3(appendix, lstAppendixMH3.length)
            $("#appendixTableMH3 #appendixTbodyMH3").append(htmlRow);
            lstAppendixMH3.push(appendix);
            if (lstAppendixMH3.length > 100) {
                $("#addRowAppendixTableMH3").prop("disabled", true);
            }
            else {
                $("#addRowAppendixTableMH3").prop("disabled", false);
            }
        });

        function generateTenTayIn(appendix, index) {
            var htmlRow = `<select class="form-control ten_tay_in1" required style="width: 100%" id="tentayin1_${index + 1}">`;
            htmlRow += `<option value="" selected}>---Chọn---</option > `;
            for (var i = 0; i < lstAppendixMH3.length; i++) {
                htmlRow += `<option value = "${lstAppendixMH3[i].ten_tay_in}" ${lstAppendixMH3[i].ten_tay_in == lstAppendixMH3.ten_tay_in ? 'selected' : ''}> ${lstAppendixMH3[i].ten_tay_in}</option> `;
            }
            htmlRow += `</select>`
            return htmlRow;
        }

        function generateHtmlCheBanConfigMH3(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                            <td id="STT" class="text-center">${index + 1}</td>
                            <td style="display:none;">
                                <input type="text" style="display:none;" class="form-control inputText vat_tu_id1" value="${appendix.vat_tu_id == null ? '' : appendix.vat_tu_id}" id="vattuid1_${index + 1}"/>
                            </td>
                            <td>
                                ${generateTenTayIn(appendix, index)}
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_kem1" onchange="AutoFillTongCheBan(this)" value="${appendix.so_kem == null ? '' : appendix.so_kem}" id="sokem1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_bo1" onchange="AutoFillTongCheBan(this)" value="${appendix.so_bo == null ? '' : appendix.so_bo}" id="sobo1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" disabled class="form-control iinteger inputText tong1" value="${appendix.tong == null ? '' : appendix.tong}" id="tong1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText trang1" value="${appendix.trang == null ? '' : appendix.trang}" id="trang1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_in_dai1" onchange="FillDataKhoInDai(this)" value="${appendix.kho_in_dai == null ? '' : appendix.kho_in_dai}" id="khoindai1_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_in_rong1" onchange="FillDataKhoInRong(this)" value="${appendix.kho_in_rong == null ? '' : appendix.kho_in_rong}" id="khoinrong1_${index + 1}"/>
                            </td>
                            <td>
                                ${generateKhoKem(appendix, index)}
                            </td>
                            <td>
                                ${generatePPIn(appendix, index)}
                            </td>
                            <td class="text-center">
                                <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" onclick="removeAppendixRowMH3(this)" id="removeAppendixRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>`
        }

        function removeAppendixRowMH3(element) {
            var row = parseInt($(element).attr("myid"));
            $(element).parent().parent().remove();
            lstAppendixMH3.splice(row - 1, 1);
            if (row <= lstAppendixMH3.length) {
                for (r = row + 1; r <= lstAppendixMH3.length + 1; r++) {
                    $("#appendixTableMH3 #standard_" + r + " #STT").text(row);

                    $("#appendixTableMH3 #standard_" + r + " .ac").removeAttr("myid");
                    $("#appendixTableMH3 #standard_" + r + " .ac").attr("myid", "re_" + row);
                    $("#appendixTableMH3 #standard_" + r + " .ac").attr("id", "ac_" + row);

                    $("#appendixTableMH3 #standard_" + r + " .re").removeAttr("myid");
                    $("#appendixTableMH3 #standard_" + r + " .re").attr("myid", "ac_" + row);
                    $("#appendixTableMH3 #standard_" + r + " .re").attr("id", "re_" + row);

                    $("#appendixTableMH3 #standard_" + r + " .appendix-row").removeAttr("myid");
                    $("#appendixTableMH3 #standard_" + r + " .appendix-row").attr("myid", row);
                    $("#appendixTableMH3 #standard_" + r + " .appendix-row").attr("id", "removeAppendixRow_" + row);

                    $("#appendixTableMH3 #standard_" + r).attr("id", "standard_" + row);
                    row = row + 1;
                }
            }
        }

        ////// bảng in thứ 2 //////////////
        function generateHtmlAppendixPrint(lstAppendixPrint) {
            var htmlAllRows = '';
            for (var i = 0; i < lstAppendixPrint.length; i++) {
                htmlAllRows = htmlAllRows + generateHtmlAppendixPrintRow(lstAppendixPrint[i], i);
            }
            return htmlAllRows;
        }

        function generatePPInPrint(appendix, index) {
            var htmlRow = `<select class="form-control phuong_phap_in" required style="width: 100%" id="phuongphapin_${index + 1}">`;
            htmlRow += `<option value="" ${appendix.phuong_phap_in == '' ? 'selected' : ''}>-Chọn-</option > `;
            for (var i = 0; i < lstlstPPIn.length; i++) {
                htmlRow += `<option value = "${lstlstPPIn[i].id}" ${lstlstPPIn[i].id == appendix.phuong_phap_in ? 'selected' : ''}> ${lstlstPPIn[i].Name.trim()}</option> `;
            }
            htmlRow += `</select>`
            return htmlRow;
        }

        function generateHtmlAppendixPrintRow(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                            <td id="STT" class="text-center">${index + 1}</td>
                            <td style="display:none;">
                                <input type="text" style="display:none;" class="form-control inputText vat_tu_id" value="${appendix.vat_tu_id == null ? '' : appendix.vat_tu_id}" id="vattuid_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control inputText ten_tay_in" value="${appendix.ten_tay_in == null ? '' : appendix.ten_tay_in}" id="tentayin_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control inputText ten_loai" value="${appendix.ten_loai == null ? '' : appendix.ten_loai}" id="tenloai_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText dinh_luong_giay_in" value="${appendix.dinh_luong_giay_in == null ? '' : appendix.dinh_luong_giay_in}" id="dinhluonggiayin_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_giay_dai" value="${appendix.kho_giay_dai == null ? '' : appendix.kho_giay_dai}" id="khogiaydai_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_giay_rong" value="${appendix.kho_giay_rong == null ? '' : appendix.kho_giay_rong}" id="khogiayrong_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText kho_in_dai" value="${appendix.kho_in_dai == null ? '' : appendix.kho_in_dai}" id="khoindai_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal  inputText kho_in_rong" value="${appendix.kho_in_rong == null ? '' : appendix.kho_in_rong}" id="khoinrong_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText chinh"  onchange="AutoFillTongIn(this)" value="${appendix.chinh == null ? '' : appendix.chinh}" id="chinh_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText bu_in" onchange="AutoFillTongIn(this)" value="${appendix.bu_in == null ? '' : appendix.bu_in}" id="buin_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText bu_thanh_pham" onchange="AutoFillTongIn(this)" value="${appendix.bu_thanh_pham == null ? '' : appendix.bu_thanh_pham}" id="buthanhpham_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText bu_phat_hanh" onchange="AutoFillTongIn(this)" value="${appendix.bu_phat_hanh == null ? '' : appendix.bu_phat_hanh}" id="buphathanh_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText sl_tong" value="${appendix.sl_tong == null ? '' : appendix.sl_tong}" id="sltong_${index + 1}"/>
                            </td>
                            <td>
                                ${generatePPInPrint(appendix, index)}
                            </td>
                            <td>
                                <input type="text" class="form-control idecimal inputText so_kg" value="${appendix.so_kg == null ? '' : appendix.so_kg}" id="sokg_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_luot_in_quy_doi" value="${appendix.so_luot_in_quy_doi == null ? '' : appendix.so_luot_in_quy_doi}" id="soluotinquydoi_${index + 1}"/>
                            </td>
                            <td>
                                <input type="text" class="form-control iinteger inputText so_luot_in_thuc_te" value="${appendix.so_luot_in_thuc_te == null ? '' : appendix.so_luot_in_thuc_te}" id="soluotinthucte_${index + 1}"/>
                            </td>
                            <td class="text-center">
                                <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" onclick="removeAppendixPrintRow(this)" id="removeAppendixPrintRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>`
        }


        $("#addRowprintTable").click(function () {
            var appendix = {
                ten_tay_in: '',
                ten_loai: '',
                kho_giay: '',
                kho_in_dai: '',
                kho_in_rong: '',
                chinh: '',
                bu_in: '',
                bu_thanh_pham: '',
                sl_tong: '',
                phuong_phap_in: '',
                so_kg: '',
                so_luot_in_quy_doi: '',
                so_luot_in_thuc_te: '',
            };
            var htmlRow = generateHtmlAppendixPrintRow(appendix, lstAppendixPrint.length)
            $("#printTable #appendixPrintTbody").append(htmlRow);
            lstAppendixPrint.push(appendix);

            // kích thêm mới dòng bảng in tự động fill thông tin từ bảng chế bản
            var khoindai = $('#khoindai1_' + lstAppendixPrint.length).val();
            $('#khoindai_' + lstAppendixPrint.length).val(khoindai);

            var khoinrong = $('#khoinrong1_' + lstAppendixPrint.length).val();
            $('#khoinrong_' + lstAppendixPrint.length).val(khoinrong);

            var ppin = $('#phuongphapin1_' + lstAppendixPrint.length).val();
            $('#phuongphapin_' + lstAppendixPrint.length).val(ppin);

            var tayin = $('#tentayin1_' + lstAppendixPrint.length).val();
            $('#tentayin_' + lstAppendixPrint.length).val(tayin);

            if (lstAppendixPrint.length > 100) {
                $("#addRowprintTable").prop("disabled", true);
            }
            else {
                $("#addRowprintTable").prop("disabled", false);
            }
        });

        function removeAppendixPrintRow(element) {
            var row = parseInt($(element).attr("myid"));
            $(element).parent().parent().remove();
            lstAppendixPrint.splice(row - 1, 1);
            if (row <= lstAppendixPrint.length) {
                for (r = row + 1; r <= lstAppendixPrint.length + 1; r++) {
                    $("#printTable #standard_" + r + " #STT").text(row);
                    $("#printTable #standard_" + r + " .ac").removeAttr("myid");
                    $("#printTable #standard_" + r + " .ac").attr("myid", "re_" + row);
                    $("#printTable #standard_" + r + " .ac").attr("id", "ac_" + row);
                    $("#printTable #standard_" + r + " .re").removeAttr("myid");
                    $("#printTable #standard_" + r + " .re").attr("myid", "ac_" + row);
                    $("#printTable #standard_" + r + " .re").attr("id", "re_" + row);
                    $("#printTable #standard_" + r + " .appendix-row").removeAttr("myid");
                    $("#printTable #standard_" + r + " .appendix-row").attr("myid", row);
                    $("#printTable #standard_" + r + " .appendix-row").attr("id", "removeAppendixPrintRow_$" + row);
                    $("#printTable #standard_" + r).attr("id", "standard_" + row);
                    row = row + 1;
                }
            }
        }

        /////////bảng SL Tổng///////////////
        function generateHtmlAppendSoLuongTong(lstAppenSLTong) {
            var htmlAllRows = '';
            for (var i = 0; i < lstAppenSLTong.length; i++) {
                htmlAllRows = htmlAllRows + generateHtmlAppendSLTongRow(lstAppenSLTong[i], i);
            }
            return htmlAllRows;
        }

        function generateHtmlAppendSLTongRow(appendix, index) {
            return `<tr id="standard_${index + 1}" class="appendixRow">
                            <td id="STT" class="text-center">${index + 1}</td>
                            <td>
                                <input type="text" class="form-control inputText Values" value="${appendix.Values == null ? '' : appendix.Values}" />
                            </td>
                            <td class="text-center">
                                <a class="btn btn-sm widget-btn-red red p5 lock remove-row appendix-row" onclick="removeAppendSLTongRow(this)" id="removeAppendSLTongRow_${index + 1}" myid="${index + 1}" title="Xóa">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>`
        }


        $("#addRowSLTong").click(function () {
            var appendix = {
                Values: '',
            };
            var htmlRow = generateHtmlAppendSLTongRow(appendix, lstAppenSLTong.length)
            $("#printTableSLTong #appendixPrintTbodySLTong").append(htmlRow);
            lstAppenSLTong.push(appendix);
            if (lstAppenSLTong.length > 100) {
                $("#addRowSLTong").prop("disabled", true);
            }
            else {
                $("#addRowSLTong").prop("disabled", false);
            }
        });


        function removeAppendSLTongRow(element) {
            var row = parseInt($(element).attr("myid"));
            $(element).parent().parent().remove();
            lstAppenSLTong.splice(row - 1, 1);
            if (row <= lstAppenSLTong.length) {
                for (r = row + 1; r <= lstAppenSLTong.length + 1; r++) {
                    $("#printTableSLTong #standard_" + r + " #STT").text(row);
                    $("#printTableSLTong #standard_" + r + " .ac").removeAttr("myid");
                    $("#printTableSLTong #standard_" + r + " .ac").attr("myid", "re_" + row);
                    $("#printTableSLTong #standard_" + r + " .ac").attr("id", "ac_" + row);
                    $("#printTableSLTong #standard_" + r + " .re").removeAttr("myid");
                    $("#printTableSLTong #standard_" + r + " .re").attr("myid", "ac_" + row);
                    $("#printTableSLTong #standard_" + r + " .re").attr("id", "re_" + row);
                    $("#printTableSLTong #standard_" + r + " .appendix-row").removeAttr("myid");
                    $("#printTableSLTong #standard_" + r + " .appendix-row").attr("myid", row);
                    $("#printTableSLTong #standard_" + r + " .appendix-row").attr("id", "removeAppendSLTongRow_$" + row);
                    $("#printTableSLTong #standard_" + r).attr("id", "standard_" + row);
                    row = row + 1;
                }
            }
        }

        //////////////////////Su ly su kien tự động fill data///////////////////////////

        function FillDataKhoInDai(element) {
            var value = $(element).val().trim();
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);
            $('#khoindai_' + numberid).val(value);
        }

        function FillDataKhoInRong(element) {
            var value = $(element).val().trim();
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);
            $('#khoinrong_' + numberid).val(value);
        }

        function FillDataPhuongPhapIn(element) {
            var value = $(element).val().trim();
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);
            $('#phuongphapin_' + numberid).val(value);
        }

        function AutoTinhDinhMuc(element) {
            var trangMH2 = $(element).val() * 1;
            var id = $(element).attr("id");
            var index = id.indexOf('_');

            var numberid = id.substring(index + 1);
            var trangMH1 = ($('#trangMH1MH2_' + numberid).val() * 1 == 0) ? 1 : $('#trangMH1MH2_' + numberid).val() * 1;
            var dinhmuc = (trangMH1 / trangMH2).toFixed(2);
            $('#dinhmucMH2_' + numberid).val(dinhmuc);
            var soLuong = ($('#soluongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#soluongMH2_' + numberid).val() * 1;
            var soLuongChinh = (soLuong * dinhmuc).toFixed(2);
            $('#slchinhMH2_' + numberid).val(soLuongChinh);

            var soLuongBuIn = $('#slbuinMH2_' + numberid).val() * 1;
            var soLuongBuTP = $('#slbutpMH2_' + numberid).val() * 1;
            var soLuongChinh = $('#slchinhMH2_' + numberid).val() * 1;

            var slTong = (soLuongChinh + soLuongBuIn + soLuongBuTP).toFixed(2);
            $('#sltongMH2_' + numberid).val(slTong);
        }

        function AutoTinhSoLuongChinh(element) {
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);

            var soLuong = ($('#soluongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#soluongMH2_' + numberid).val() * 1;
            var dinhMuc = ($('#dinhmucMH2_' + numberid).val() * 1 == 0) ? 1 : $('#dinhmucMH2_' + numberid).val() * 1;

            var soLuongChinh = (soLuong * dinhMuc).toFixed(2);
            $('#slchinhMH2_' + numberid).val(soLuongChinh);

            /// tính số lượng tổng
            var soLuongBuIn = $('#slbuinMH2_' + numberid).val() * 1;
            var soLuongBuTP = $('#slbutpMH2_' + numberid).val() * 1;
            var slChinh = $('#slchinhMH2_' + numberid).val() * 1;

            var slTong = (slChinh + soLuongBuIn + soLuongBuTP).toFixed(2);
            $('#sltongMH2_' + numberid).val(slTong);
        }

        function AutoTinhSoLuongTong(element) {
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);

            var soLuongBuIn = $('#slbuinMH2_' + numberid).val() * 1;
            var soLuongBuTP = $('#slbutpMH2_' + numberid).val() * 1;
            var soLuongChinh = $('#slchinhMH2_' + numberid).val() * 1;

            var slTong = (soLuongChinh + soLuongBuIn + soLuongBuTP).toFixed(2);
            $('#sltongMH2_' + numberid).val(slTong);

            ////tính ô quy ký
            var dinhLuong = ($('#dinhluongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#dinhluongMH2_' + numberid).val() * 1;
            var khoGiayDai = ($('#khogiaydaiMH2_' + numberid).val() * 1 == 0) ? 1 : $('#khogiaydaiMH2_' + numberid).val() * 1;
            var khoGiayRong = ($('#khogiayrongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#khogiayrongMH2_' + numberid).val() * 1;
            var soLuongTong = ($('#sltongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#sltongMH2_' + numberid).val() * 1;
            var quyKy = ((dinhLuong * khoGiayDai * khoGiayRong * soLuongTong) / 10000000).toFixed(2);
            $('#quykyMH2_' + numberid).val(quyKy);
        }

        function AutoTinhQuyKy(element) {
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);

            var dinhLuong = ($('#dinhluongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#dinhluongMH2_' + numberid).val() * 1;
            var khoGiayDai = ($('#khogiaydaiMH2_' + numberid).val() * 1 == 0) ? 1 : $('#khogiaydaiMH2_' + numberid).val() * 1;
            var khoGiayRong = ($('#khogiayrongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#khogiayrongMH2_' + numberid).val() * 1;
            var soLuongTong = ($('#sltongMH2_' + numberid).val() * 1 == 0) ? 1 : $('#sltongMH2_' + numberid).val() * 1;
            var quyKy = ((dinhLuong * khoGiayDai * khoGiayRong * soLuongTong) / 10000000).toFixed(2);
            $('#quykyMH2_' + numberid).val(quyKy);
        }

        function AutoFillTongCheBan(element) {
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);
            var sokem1 = ($('#sokem1_' + numberid).val() * 1 == 0 ? 1 : $('#sokem1_' + numberid).val() * 1);
            var sobo1 = ($('#sobo1_' + numberid).val() * 1 == 0 ? 1 : $('#sobo1_' + numberid).val() * 1);

            var tong1 = (sokem1 * sobo1);
            $('#tong1_' + numberid).val(tong1);
        }

        function AutoFillTongIn(element) {
            var id = $(element).attr("id");
            var index = id.indexOf('_');
            var numberid = id.substring(index + 1);
            var chinh = $('#chinh_' + numberid).val() * 1;
            var buin = $('#buin_' + numberid).val() * 1;
            var butp = $('#buthanhpham_' + numberid).val() * 1;
            var buph = $('#buphathanh_' + numberid).val() * 1;

            var tong = (chinh + buin + butp + buph).toFixed(2);
            $('#sltong_' + numberid).val(tong);
        }

        function AutoFillTPSoLuong() {
            var slTong = $('#so_luong_tong').val() * 1;
            var tpSoCuon = $('#tp_socuon_thung').val() * 1;

            var sl = Math.ceil(slTong / tpSoCuon);
            $('#tp_soluong').val(sl);
        }

        function AutoFillDungCongThuc(element) {
            var value = $(element).val();
            if (value == 1) {
                $('#tp_socuon_thung').attr("onchange", "AutoFillTPSoLuong()");
                $('#tp_thung').attr("title", "Có dùng công thức");
                $('#tp_socuon_thung').attr("title", "Có dùng công thức");
                $('#tp_soluong').attr("title", "Có dùng công thức");
                $('#tp_soluong').attr("disabled", "disabled");
            }
            if (value == 2) {
                $('#tp_socuon_thung').attr("onchange", "");
                $('#tp_thung').attr("title", "Không dùng công thức");
                $('#tp_socuon_thung').attr("title", "Không dùng công thức");
                $('#tp_soluong').attr("title", "Không dùng công thức");
                $('#tp_soluong').attr("disabled", false);
            }

        }

        function AutoFillTPSoLuongBangKeo(element) {
            var value = $(element).val();
            var tpdai = $('#tp_dai').val() * 1;
            var tprong = $('#tp_rong').val() * 1;
            var tpcao = $('#tp_cao').val() * 1;
            var tpsl = $('#tp_soluong').val() * 1;

            if (value == 1) {
                var slBangKeo = Math.ceil(((tpdai + tprong + 40) * 2) / 100 * tpsl);
                $('#tp_sl_bangkeo').val(slBangKeo);
                $('#bangkeo').attr("title", "Công thức tính số lượng: (dài + rộng + 40) * 2 / 100 * số thùng");
                $('#tp_sl_bangkeo').attr("title", "Công thức tính số lượng: (dài + rộng + 40) * 2 / 100 * số thùng");
            }
            if (value == 2) {
                var slBangKeoDacBiet = Math.ceil(((tpdai * 2) + ((tprong + tpcao) * 4) + 60) / 100 * tpsl);
                $('#tp_sl_bangkeo').val(slBangKeoDacBiet);
                $('#bangkeo').attr("title", "Công thức tính số lượng: ((dài * 2) + ((rộng + cao) * 4) + 60)/100 * số thùng");
                $('#tp_sl_bangkeo').attr("title", "Công thức tính số lượng: ((dài * 2) + ((rộng + cao) * 4) + 60)/100 * số thùng");
            }

        }

        function AutoTinhSLBangKeo(element) {
            var tpdai = $('#tp_dai').val() * 1;
            var tprong = $('#tp_rong').val() * 1;
            var tpcao = $('#tp_cao').val() * 1;
            var tpsl = $('#tp_soluong').val() * 1;
            var slbk = $('#bangkeo').val();

            if (slbk == "") return false;
            if (slbk == 1) {
                var slBangKeo = Math.ceil(((tpdai + tprong + 40) * 2) / 100 * tpsl);
                $('#tp_sl_bangkeo').val(slBangKeo);
                $('#bangkeo').attr("title", "Công thức tính số lượng: (dài + rộng + 40) * 2 / 100 * số thùng");
                $('#tp_sl_bangkeo').attr("title", "Công thức tính số lượng: (dài + rộng + 40) * 2 / 100 * số thùng");
            }
            if (slbk == 2) {
                var slBangKeoDacBiet = Math.ceil(((tpdai * 2) + ((tprong + tpcao) * 4) + 60) / 100 * tpsl);
                $('#tp_sl_bangkeo').val(slBangKeoDacBiet);
                $('#bangkeo').attr("title", "Công thức tính số lượng: ((dài * 2) + ((rộng + cao) * 4) + 60)/100 * số thùng");
                $('#tp_sl_bangkeo').attr("title", "Công thức tính số lượng: ((dài * 2) + ((rộng + cao) * 4) + 60)/100 * số thùng");
            }

        }



        //////////////////////////Get all data/////////////////////////////////////

        var textnoti = `<span class="red">Số LSX không được để trống!</span>`;

        function GetDataAllScreen() {
            $("#textvalid").empty();
            var lsx = $("#so_lenh_sx").val();
            if (lsx == null || lsx == "" || lsx == ' ') {
                $(".textNoti").html(textnoti);
                toastr.warning('Bạn chưa nhập đầy đủ thông tin');
            }
            else {
                var data = {
                    id: $('#id').val() * 1,
                    so_lenh_sx: $('#so_lenh_sx').val().trim(),
                    loai: $('#loai').val().trim(),
                    created_date: $('#created_date').val().trim(),
                    email: $('#email').val().trim(),
                    kho_doc: $('#kho_doc').val(),
                    kho_ngang: $('#kho_ngang').val(),
                    lan_dieu_chinh: $('#lan_dieu_chinh').val(),
                    ma_khach_hang: $('#ma_khach_hang').val().trim(),
                    ma_san_pham: $('#ma_san_pham').val().trim(),
                    nha_cc: $('#nha_cc').val().trim(),
                    nv_kinh_doanh: $('#nv_kinh_doanh').val().trim(),
                    phieu_dnsx_so: $('#phieu_dnsx_so').val().trim(),
                    phone_number: $('#phone_number').val().trim(),
                    email: $('#email').val().trim(),
                    quy_cach_chung: $('#quy_cach_chung').val().trim(),
                    ten_can_bo_kt: $('#ten_can_bo_kt').val().trim(),
                    ten_can_bo_ql: $('#ten_can_bo_ql').val().trim(),
                    ten_khach_hang: $('#ten_khach_hang').val().trim(),
                    ten_san_pham: $('#ten_san_pham').val().trim(),
                    ngay_giao_hang: $('#ngay_giao_hangMH3').val().trim(),
                    cb_thoi_gian_giao: $('#cb_thoi_gian_giao').val().trim(),
                    cb_ghi_chu: $('#cb_ghi_chu').val().trim(),
                    in_ghi_chu: $('#in_ghi_chu').val().trim(),
                    //in_thoi_gian_giao: $('#in_thoi_gian_giao').val().trim(),
                    thanh_pham_chung: $('#thanh_pham_chung').val().trim(),
                    tp_ghi_chu: $('#tp_ghi_chu').val().trim(),
                    tp_thoi_han: $('#tp_thoi_han').val().trim(),
                    so_luong_tong: $('#so_luong_tong').val(),
                    tp_dai: $('#tp_dai').val() * 1,
                    tp_rong: $('#tp_rong').val() * 1,
                    tp_cao: $('#tp_cao').val() * 1,
                    tp_soluong: $('#tp_soluong').val() * 1,
                    tp_socuon_thung: $('#tp_socuon_thung').val() * 1,
                    tp_sl_bangkeo: $('#tp_sl_bangkeo').val() * 1,
                    tp_vat_tu: $('#bangkeo').val() * 1,

                    lstVatTus: GetInfoDetail(), //thông tin bảng details tổng quan đơn hàng
                    lstChiTietDuToans: GetInfoChiTietDuToan(), //thông tin bảng details dự toán
                    lst_sl_tong: GetInfoSoLuongTong(), //thông tin bảng số lượng tổng
                    lstChiTietCheBans: GetInfoChiTietCheBan(), //thông tin bảng chế phẩm
                    lstChiTietIns: GetInfoChiTietBangIn(),  //thông tin bảng in
                }
                return data;
            }
            return false;
        }

        function AddOrUpdateAllScreen() {
            var data = GetDataAllScreen();
            if (data != false) {

                var title2 = "Bạn có đồng ý cập nhật không?";
                var url = '/Material/AddorUpdateDonHang';
                if ($("form#edit").valid()) {
                    swal({
                        title: title2,
                        icon: "warning",
                        buttons: {
                            ok: "Xác nhận",
                            cancel: "Hủy",
                        }
                    }).then((isConfirm) => {
                        if (isConfirm != 'ok') {

                        } else {
                            $.post(url, data,
                                function (rs) {
                                    if (rs.status > 0) {
                                        swal({
                                            title: "Cập nhật thành công!",
                                            text: "Dữ liệu của bạn đã được cập nhật!",
                                            icon: "success",
                                        }).then(function (isConfirm) {
                                            viewReportInNewWindow('/Report/ExportExcelBangLSX?id=' + rs.status + '&exportExcel=false#view=FitH');
                                            window.location.href = '/Material/Edit/0';
                                        });
                                    }
                                    else {
                                        toastr.error(rs.message);
                                    }
                                });
                        }
                    });
                }
            }

        }

        function viewReportInNewWindow(url) {
            var params = [
                'left=0',
                'top=0',
                'height=' + window.outerHeight,
                'width=' + window.outerWidth,
                'fullscreen=yes' // only works in IE, but here for completeness
            ].join(',');
            console.log(params);
            var randomnumber = Math.floor((Math.random() * 100) + 1);
            var popup = window.open(url, "_blank", 'popup_window', randomnumber, params);
        }
    </script>
}
